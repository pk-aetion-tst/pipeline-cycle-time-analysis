{"uid":"c8360e33f060c2a8","name":"Verify that webapp is able to load all installed datasets into the schema cache. marketscan_tiny_adm_default_20240716 should be loaded successfully into the schema cache.","fullName":"com.aetion.konohanasakuya.integration.sanity.SchemaCacheLoaderSanityTest.verifyWebappKnowsDatasetIsInstalled","historyId":"22f6c7fd37f4cda0a9673be60fbdc6fa","time":{"start":1771957458364,"stop":1771957458366,"duration":2},"description":"When webapp starts up, it'll send a request to /api/v1/patient-datasets/latest-datasets?instanceId={instanceId}\nto get a list of all the currently installed datasets in that instance. This only returns datasets that are active\nand associated with that instance id in the patient_dataset_instances table.\n\nFor each patient dataset in that list, it'll have an associated entry in the datasets table with the guid\nbeing mapped to the patient_dataset's schema_guid if that dataset is the active revision in that instance.\nFor each patient dataset without an entry in that table matching the schema_guid, this means that the dataset\nis technically installed in that instance, but it is not active.\n\nIf there are any issues with webapp starting up and being able to parse a dataset's information, then\nwebapp skips the dataset, logs the error, and moves on to the next dataset. The result is the datasets\nbeing loaded into the schema cache on startup. Subsequent calls to the schema controller will use the\nschema cache.\n\nThe exception to datasets that are in scope for this check are deprecated datasets. They will appear\nto be installed to the instance still from schema-service, but due to their files no longer existing in the\nruntime directory, these datasets will not be loaded into the schema cache when webapp starts up.\n\nIn order to detect if the dataset has been loaded correctly, this test will attempt to fetch the dataset's\nDatasetInfoPair using the dataset id and the dataset_instance id. If the dataset is not loaded properly by\nwebapp, then the schema cache won't return anything and we will see an internal error thrown.\n\nIf this test fails, check webapp's startup logs. There will most likely be an exception thrown when\nattempting to add a dataset to the schema cache loader.\n","descriptionHtml":"<p>When webapp starts up, it'll send a request to /api/v1/patient-datasets/latest-datasets?instanceId={instanceId}<br />\nto get a list of all the currently installed datasets in that instance. This only returns datasets that are active<br />\nand associated with that instance id in the patient_dataset_instances table.</p>\n<p>For each patient dataset in that list, it'll have an associated entry in the datasets table with the guid<br />\nbeing mapped to the patient_dataset's schema_guid if that dataset is the active revision in that instance.<br />\nFor each patient dataset without an entry in that table matching the schema_guid, this means that the dataset<br />\nis technically installed in that instance, but it is not active.</p>\n<p>If there are any issues with webapp starting up and being able to parse a dataset's information, then<br />\nwebapp skips the dataset, logs the error, and moves on to the next dataset. The result is the datasets<br />\nbeing loaded into the schema cache on startup. Subsequent calls to the schema controller will use the<br />\nschema cache.</p>\n<p>The exception to datasets that are in scope for this check are deprecated datasets. They will appear<br />\nto be installed to the instance still from schema-service, but due to their files no longer existing in the<br />\nruntime directory, these datasets will not be loaded into the schema cache when webapp starts up.</p>\n<p>In order to detect if the dataset has been loaded correctly, this test will attempt to fetch the dataset's<br />\nDatasetInfoPair using the dataset id and the dataset_instance id. If the dataset is not loaded properly by<br />\nwebapp, then the schema cache won't return anything and we will see an internal error thrown.</p>\n<p>If this test fails, check webapp's startup logs. There will most likely be an exception thrown when<br />\nattempting to add a dataset to the schema cache loader.</p>\n","status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"description":"When webapp starts up, it'll send a request to /api/v1/patient-datasets/latest-datasets?instanceId={instanceId}\nto get a list of all the currently installed datasets in that instance. This only returns datasets that are active\nand associated with that instance id in the patient_dataset_instances table.\n\nFor each patient dataset in that list, it'll have an associated entry in the datasets table with the guid\nbeing mapped to the patient_dataset's schema_guid if that dataset is the active revision in that instance.\nFor each patient dataset without an entry in that table matching the schema_guid, this means that the dataset\nis technically installed in that instance, but it is not active.\n\nIf there are any issues with webapp starting up and being able to parse a dataset's information, then\nwebapp skips the dataset, logs the error, and moves on to the next dataset. The result is the datasets\nbeing loaded into the schema cache on startup. Subsequent calls to the schema controller will use the\nschema cache.\n\nThe exception to datasets that are in scope for this check are deprecated datasets. They will appear\nto be installed to the instance still from schema-service, but due to their files no longer existing in the\nruntime directory, these datasets will not be loaded into the schema cache when webapp starts up.\n\nIn order to detect if the dataset has been loaded correctly, this test will attempt to fetch the dataset's\nDatasetInfoPair using the dataset id and the dataset_instance id. If the dataset is not loaded properly by\nwebapp, then the schema cache won't return anything and we will see an internal error thrown.\n\nIf this test fails, check webapp's startup logs. There will most likely be an exception thrown when\nattempting to add a dataset to the schema cache loader.\n","status":"passed","steps":[{"name":"Given that schema is showing that following dataset should be installed to this instance: MARKETSCAN_TINY_ADM","time":{"start":1771957458365,"stop":1771957458365,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Then webapp should have the dataset as an entry from the response from aetion-webapp/rest/schema/datasets ","time":{"start":1771957458365,"stop":1771957458365,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"tag","value":"schema-cache-loader"},{"name":"tag","value":"sanity"},{"name":"tag","value":"gxp-iq"},{"name":"junit.platform.uniqueid","value":"[engine:junit-jupiter]/[class:com.aetion.konohanasakuya.integration.sanity.SchemaCacheLoaderSanityTest]/[test-template:verifyWebappKnowsDatasetIsInstalled(java.lang.String, java.lang.String, java.util.Map)]/[test-template-invocation:#15]"},{"name":"epic","value":"Sanity Checks"},{"name":"gxp.qualification.stage","value":"IQ"},{"name":"story","value":"A user should be able to view all datasets installed in an instance."},{"name":"host","value":"agentpool-dev1-b-default-00000"},{"name":"thread","value":"3423@agentpool-dev1-b-default-00000.ForkJoinPool-1-worker-6(34)"},{"name":"framework","value":"junit-platform"},{"name":"language","value":"java"},{"name":"package","value":"com.aetion.konohanasakuya.integration.sanity.SchemaCacheLoaderSanityTest"},{"name":"testClass","value":"com.aetion.konohanasakuya.integration.sanity.SchemaCacheLoaderSanityTest"},{"name":"testMethod","value":"verifyWebappKnowsDatasetIsInstalled"},{"name":"suite","value":"Verify that webapp is able to load all datasets installed to the instance."},{"name":"severity","value":"blocker"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"arg0","value":"MARKETSCAN_TINY_ADM"},{"name":"arg1","value":"MARKETSCAN_TINY_ADM_DEFAULT_20241206"},{"name":"arg2","value":"{MARKETSCAN_ADM_2M=MARKETSCAN_ADM_2M_DEFAULT_2024071601, MARKETSCAN_ADM_1M=MARKETSCAN_ADM_1M_DEFAULT_20240523, SYNPUF_SUBSET=SYNPUF_SUBSET_DEFAULT_2024030701, SYNTHETIC_OMOP=SYNTHETIC_OMOP_ADN_2025060401, MARKETSCAN_ADM=MARKETSCAN_ADM_DEFAULT_20241206, MARKETSCAN_ADN=MARKETSCAN_ADN_PL_20190601, MARKETSCAN_NA_CDM=MARKETSCAN_NA_CDM_CDM_2023052604, SYNPUF_TINY_SUBSET=SYNPUF_TINY_SUBSET_DEFAULT_20220720, MARKETSCAN_ADM_225M=MARKETSCAN_ADM_225M_DEFAULT_20241206, MARKETSCAN_CDM_2M=MARKETSCAN_CDM_2M_CDM_2023052601, MARKETSCAN_TINY_CDM=MARKETSCAN_TINY_CDM_CDM_2023102602, SYNPUF_MULTIDATE=SYNPUF_MULTIDATE_DEFAULT_20220329, MARKETSCAN_TINY_ADM=MARKETSCAN_TINY_ADM_DEFAULT_20241206, SYNPUF=SYNPUF_DEFAULT_2021071202, LOOPBACK_ADM=LOOPBACK_ADM_ADN_2024100103, MDV_ADM=MDV_ADM_ONO_20250603, SYNPUF_ADM=SYNPUF_ADM_ADN_2024061102}"}],"links":[{"name":"PE-4620 on Jira","url":"https://aetion.atlassian.net/browse/PE-4620"},{"name":"Webapp's Logs","url":"https://monitoring.dev.aetion.com/explore?orgId=1&left=%7B%22datasource%22:%22loki_logs%22,%22queries%22:%5B%7B%22refId%22:%22A%22,%22datasource%22:%7B%22type%22:%22loki%22,%22uid%22:%22loki_logs%22%7D,%22editorMode%22:%22builder%22,%22expr%22:%22%7Bnamespace%3D%5C%22aep%5C%22,%20pod%3D~%5C%22webapp.%2B%5C%22%7D%22,%22queryType%22:%22range%22%7D%5D,%22range%22:%7B%22from%22:%221771957458365%22,%22to%22:%221771957458365%22%7D%7D","type":"logs"}],"hidden":false,"retry":false,"extra":{"severity":"blocker","retries":[],"categories":[],"tags":["gxp-iq","schema-cache-loader","sanity"]},"source":"c8360e33f060c2a8.json","parameterValues":["MARKETSCAN_TINY_ADM","MARKETSCAN_TINY_ADM_DEFAULT_20241206","{MARKETSCAN_ADM_2M=MARKETSCAN_ADM_2M_DEFAULT_2024071601, MARKETSCAN_ADM_1M=MARKETSCAN_ADM_1M_DEFAULT_20240523, SYNPUF_SUBSET=SYNPUF_SUBSET_DEFAULT_2024030701, SYNTHETIC_OMOP=SYNTHETIC_OMOP_ADN_2025060401, MARKETSCAN_ADM=MARKETSCAN_ADM_DEFAULT_20241206, MARKETSCAN_ADN=MARKETSCAN_ADN_PL_20190601, MARKETSCAN_NA_CDM=MARKETSCAN_NA_CDM_CDM_2023052604, SYNPUF_TINY_SUBSET=SYNPUF_TINY_SUBSET_DEFAULT_20220720, MARKETSCAN_ADM_225M=MARKETSCAN_ADM_225M_DEFAULT_20241206, MARKETSCAN_CDM_2M=MARKETSCAN_CDM_2M_CDM_2023052601, MARKETSCAN_TINY_CDM=MARKETSCAN_TINY_CDM_CDM_2023102602, SYNPUF_MULTIDATE=SYNPUF_MULTIDATE_DEFAULT_20220329, MARKETSCAN_TINY_ADM=MARKETSCAN_TINY_ADM_DEFAULT_20241206, SYNPUF=SYNPUF_DEFAULT_2021071202, LOOPBACK_ADM=LOOPBACK_ADM_ADN_2024100103, MDV_ADM=MDV_ADM_ONO_20250603, SYNPUF_ADM=SYNPUF_ADM_ADN_2024061102}"]}